VmInclude:__COMPONENT__/toolbar/form-toolbar.html
<section id=form_container__ID>
	<div id=header__ID>
		Project
	</div>
	<form id=F__ID>
		<form id=F__ID>
		    <div class="container">
		    <div class="row row__ID">
				<div class="col-sm-3">
					<span>Project</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Project" type="text" id=Project__ID required>
		        </div>
		    </div>
		    <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Code</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Project_Code" type="text" id=Project_Code__ID required>
		        </div>
		    </div>
		    <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Country</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Country" type="text"  id=Country__ID readonly>
		        </div>
		    </div>
            <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Description</span>
				</div>
				<div class="col-sm-9">
		            <textarea class="form-control" name="Description" rows="3" id=Description__ID></textarea>
		        </div>
		    </div>
            <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Theme</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Theme" type="text"  id=Theme__ID required>
		        </div>
		    </div>
            <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Primary Sector</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Sector" type="text"  id=Sector__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Secondary Sector</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Secondary_Sector" type="text"  id=Secondary_Sector__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Implementation Arrangement</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Implementation_Arrangement" type="text"  id=Implementation_Arrangement__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>DRR Mainstreaming</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="DRR_Mainstreaming" type="text"  id=DRR_Mainstreaming__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Start</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Start" type="text"  id=Start__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
					<span>End</span>
				</div>
				<div class="col-sm-9">
					<input class="form-control" name="End" type="text"  id=End__ID required>
				</div>
			</div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Status</span>
				</div>
				<div class="col-sm-9">
		            <select class="form-control" name="Status"  id=Status__ID required><option value=""></option><option value="Open">Open</option><option value="Closed">Closed</option></select>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Location 1</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Location" type="text"  id=Location__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Location 2</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Location_2" type="text"  id=Location_2__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Location 3</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Location_3" type="text"  id=Location_3__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Location 4</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Location_4" type="text"  id=Location_4__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Approval Status</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Approval_Status" type="text"  id=Approval_Status__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Approval Date</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Approval_Date" type="text"  id=Approval_Date__ID required>
		        </div>
		    </div>
            <div class="row row__ID">
				<div class="col-sm-3">
		       		<span>List of people to be updated</span>
				</div>
				<div class="col-sm-9">
		            <textarea class="form-control" name="List_people_updated" placeholder="Enter your name here to receive updates of this project" rows="3" id=List_people_updated__ID></textarea>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
					<span>Comments</span>
				</div>
				<div class="col-sm-9">
					<textarea class="form-control" name="New_Comments" placeholder="Enter Comments here" rows="3" id=New_Comments__ID></textarea>
				</div>
			</div>
			<div class="row row__ID">
				<div class="col-sm-3">
					<span>Comments History</span>
				</div>
				<div class="col-sm-9">
					<textarea class="form-control" name="Comments_P" placeholder="" rows="3" id=Comments_P__ID></textarea>
				</div>
			</div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Creation Date</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Creation_Date" type="text"  id=Creation_Date__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Created By</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Created_By" type="text"  id=Created_By__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
		       		<span>Additional funds requested</span>
				</div>
				<div class="col-sm-9">
		            <input class="form-control" name="Request_Fund" type="checkbox"  id=Request_Fund__ID required>
		        </div>
		    </div>
			<div class="row row__ID">
				<div class="col-sm-3">
					<span>Requested amount &amp; FY(s)</span>
				</div>
				<div class="col-sm-9">
					<textarea class="form-control" name="Requested_amount" placeholder="" rows="3" id=Requested_amount__ID></textarea>
				</div>
			</div>
		    <div class="row row__ID">
				<div class="col-sm-3">
			       <span>Document</span>
			   </div>
			   <div class="col-sm-9">
					<div id=DocProgram__ID data-id=DocProgram name=DocProgram></div>
		        </div>
		    </div>
			<div class="row">
				<div class=col>
					<button id=submit__ID type="submit" class="btn btn-secondary">Submit</button>
				</div>
			</div>
		</div>
	</form>
</section>
<script>
    function F__ID(){
		//Vm Include:__COMPONENT__/module/form.v1.js
		//-------------------------------------
		var _json='';
		//-------------------------------------
		var this_module=$vm.module_list[$vm.vm['__ID'].name];
		var prefix=this_module.prefix; if(prefix==undefined) prefix="";
		//-------------------------------------
		$('#D__ID').on('load',function(){
		    $('#F__ID')[0].reset();
		    $('#submit__ID').show();
		    var grid_record=$vm.vm['__ID'].op.record;
		    $('#delete__ID').hide(); if(grid_record!=undefined && grid_record.ID!==undefined) $('#delete__ID').show();
		    $vm.deserialize(grid_record,'#F__ID');
			$vm.render_file_field(grid_record,'__ID',$('#DocProgram__ID'));
		})
		//-------------------------------------
		$('#Start__ID').datepicker({dateFormat:'M yy',changeMonth:true,changeYear:true, autoclose: true});
		$('#End__ID').datepicker({dateFormat:'M yy',changeMonth:true,changeYear:true, autoclose: true});
		$('#Approval_Date__ID').datepicker({dateFormat:'dd/mm/yy', autoclose: true});
		$('#Creation_Date__ID').datepicker({dateFormat:'dd/mm/yy', autoclose: true});
		//-------------------------------------
		var sql="with tb as (select name=@('Sector'),value2=uid from [TABLE-20000020] where (CHARINDEX(CHAR(10), @('Sector')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#Secondary_Sector__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		$vm.autocomplete($('#Sector__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		sql="with tb as (select name=@('Implementation_Arrangement'),value2=uid from [TABLE-20009704] where (CHARINDEX(CHAR(10), @('Implementation_Arrangement')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#Implementation_Arrangement__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		sql="with tb as (select name=@('DRR_Mainstreaming'),value2=uid from [TABLE-20009705] where (CHARINDEX(CHAR(10), @('DRR_Mainstreaming')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#DRR_Mainstreaming__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		sql="with tb as (select name=@('Theme'),value2=uid from [TABLE-20009703] where (CHARINDEX(CHAR(10), @('Theme')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#Theme__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		sql="with tb as (select name=@('Location'),value2=uid from [TABLE-20003861] where (CHARINDEX(CHAR(10), @('Location')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#Location__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		$vm.autocomplete($('#Location_2__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		$vm.autocomplete($('#Location_3__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		$vm.autocomplete($('#Location_4__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})
		sql="with tb as (select name=@('Approval_Status'),value2=uid from [TABLE-20000685] where (CHARINDEX(CHAR(10), @('Approval_Status')) = 0))";
		sql+=" select top 10 name,value=name,value2 from tb where Name like '%'+@S1+'%' ";
		$vm.autocomplete($('#Approval_Status__ID'),sql,function(key,value){
			$("#F__ID input[name="+key+"]").val($vm.text(value));
		})

		//-------------------------------------
		$('#F__ID').submit(function(event){
		    //--------------------------------------------------------
		    event.preventDefault();
		    $('#submit__ID').hide();
		    //--------------------------------------------------------
		    var data=$vm.serialize('#F__ID');
			//file.1. set as upload_unsuccessful
            var num=$vm.set_file_name_as_upload_unsuccessful(data,$('#F__ID'));
			//--------------------------------------------------------
		    var dbv={}
		    if(typeof(_before_submit)!='undefined') _before_submit(record,dbv);
		    //--------------------------------------------------------
		    var db_pid=this_module.table_id;
		    var rid=undefined; if($vm.vm['__ID'].op.record!=undefined) rid=$vm.vm['__ID'].op.record.ID;
		    var req={cmd:"add_record",db_pid:db_pid,data:data,dbv:dbv};
		    if(rid!=undefined) req={cmd:"modify_record",rid:rid,db_pid:db_pid,data:data,dbv:dbv};
			var old_rid=rid;
            $VmAPI.request({data:req,callback:function(res){
                if(num>0){
					//file.2. upload files
					if(rid==undefined)	rid=res.ret;
	                $vm.upload_form_files(rid,$('#F__ID'),function(){
	                    var data=$vm.get_original_file_name($('#F__ID'));
	                    var req={cmd:"modify_record",rid:rid,db_pid:db_pid,data:data,dbv:{}};
						//file.3. recorver name
	        			$VmAPI.request({data:req,callback:function(res){
                            $vm.refresh=1;
                            if(old_rid!=undefined) window.history.go(-1);
                            else if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.goback!=undefined) window.history.go(-1);
                            else $vm.alert('Your data has been successfully submitted');
	                    }})
	                })
				}
				else{
                    $vm.refresh=1;
                    if(old_rid!=undefined) window.history.go(-1);
                    else if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.goback!=undefined) window.history.go(-1);
                    else $vm.alert('Your data has been successfully submitted');
				}
            }});
		    //--------------------------------------------------------
		})
        //-------------------------------------
    }
</script>
<style>
	#D__ID{
		height:100%;
		overflow:auto;
		animation: vm_module_fadein 1.0s;
        background-color: #fff;
	}
    #form_container__ID{
        margin-top:20px;
		max-width: 700px;
		margin-left: auto;
		margin-right: auto;
		font-family: Verdana,sans-serif;
    	font-size: 15px;
    	line-height: 1.5;
	}
    #F__ID{
		border:1px solid #bbb;
        border-top-width: 0;
		padding:6px 15px 20px 15px;
	}
	#header__ID{
		background-color:#727b84;
		color:#fff;
		padding:10px 15px 10px 15px;
		font-size:120%;
        border:1px solid #bbb;
        border-bottom-width: 0;
	}
    .row__ID{
		padding:6px 0;
	}
	.row__ID:hover{
		background-color: rgba(0,0,0,0.1);
	}
	.row__ID span{
        font-weight:bold;
    	display: inline-block;
    	padding: 5px 0;
	}
	@media screen and (max-width:768px){
		#form_container__ID{
			padding:20px 10px 50px 10px;
		}
	}
</style>
