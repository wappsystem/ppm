<section>
	<div id=toolbar__ID class="navbar navbar-default">
	    	<div id=row_1__ID class="col-sm col-lg-3 form-inline">
		        	<button id=new__ID  type=button class='btn btn-secondary' ><i class="fa fa-plus" title='New'></i></button>
		        	<button id=save__ID type=button class='btn btn-secondary'><i class="fa fa-upload" title='Save'></i></button>
					<input id=keyword__ID type="text" placeholder="keyword" class="form-control" style="width: 150px; display:inline-block;">
					<button id=query__ID type=button class="btn btn-secondary"><i class="fa fa-search" title='Search'></i></button>
	    	</div>
	    	<div class="col-sm col-lg-3 form-inline">
		            Page Size:
		            <select id=page_size__ID class="form-control" style='margin-right:20px;display:inline-block;width:auto;'><option>30</option><option>50</option><option>100</option><option>200</option></select>
		            <span id=I__ID style="display:none">0</span><span id=A__ID></span>
		            <button id=p__ID type=button class="btn btn-secondary"><i class="fa fa-arrow-left"></i></button>
		            <button id=n__ID type=button class="btn btn-secondary"><i class="fa fa-arrow-right"></i></button>
	    	</div>
			<div class="d-none d-lg-inline-block col-lg-3 form-inline">
					Start page:	<input id=start__ID type=text class="form-control" style="width:45px; display:inline-block;" />
		            Number of page: <input id=num__ID type=text class="form-control" style="width:45px; display:inline-block;" />
					<button id=export__ID type=button class="btn btn-secondary">Export</button>
	    	</div>
	       	<span id=elapsed__ID style='float:right'></span>
			<div class="col-sm col-lg-12 form-inline">
				<h6 id=parent__ID></h6>
	    	</div>
    </div>
    <div style='max-width:500px'>
        <table id=tb__ID class="table table-bordered" >
            <colgroup><col style='width:150px'></col><col></col></colgroup>
            <thead>
                <tr><th colspan=2 ><h6>Actual Spending Details</h6></th></tr>
            </thead>
            <tbody>
                <tr><td>Financial Year</td><td id=FY__ID></td></tr>
				<tr><td>Amount Q1</td><td id=Amount_Q1__ID></td></tr>
				<tr><td>Amount Q2</td><td id=Amount_Q2__ID></td></tr>
				<tr><td>Amount Q3</td><td id=Amount_Q3__ID></td></tr>
				<tr><td>Amount Q4</td><td id=Amount_Q4__ID></td></tr>
                <tr><td>Comments</td><td id=Comments__ID></td></tr>
            </tbody>
        </table>
    </div>
    <div id=table__ID>
        <table id=grid__ID></table>
    </div>
</section>
<script>
    function F__ID(){
        //-------------------------------------
        VmInclude:/components/grid.v3.js
        _json=''; //Store data as XML - NOT json
        //-------------------------------------
        _fields="_Form,Source,Country,Amount,Donors,Comments";
        _fields+=",Submit Date|DateTime,Submitted by|Author,_Delete";
        //-------------------------------------
        var formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2,
        });
        //-------------------------------------
        _cell_render=function(records,I,field,td,set_value,source){
            switch(field){
                case 'Source':
                    var sql="with tb as (select name=@('Funding_Source') from [TABLE-"+$vm.module_list['panel_main_funding_source'].table_id+"] where LEN(@('Funding_Source'))<30)";
                    sql+=" select top 10 name,value=name from tb where name like '%'+@S1+'%' order by name ";
                    VmInclude:__COMPONENT__/grid/field_auto.js
                    break;
                case 'Country':
                    var sql="with tb as (select name=@('Country') from [TABLE-"+$vm.module_list['panel_main_country'].table_id+"] where LEN(@('Country'))<30)";
                    sql+=" select top 10 name,value=name from tb where name like '%'+@S1+'%' order by name ";
                    VmInclude:__COMPONENT__/grid/field_auto.js
                    break;
                case 'Amount':
                    if(source=="grid") td.css("text-align","right").css('white-space','nowrap');
                    td.html(formatter.format(records[I][field]));
                break;
            }
        }
        //-------------------------------------
        _cell_value_process=function(value,field){
            switch(field){
                case 'Amount': //remove $ sign and ,
                    return value.replace('$','').replace(/ /g,'').replace(/,/g,'');
            }
            return value;
        }
        //-------------------------------------
        _after_change=function(records,I,field,td,set_value,source){
            switch(field){
                case 'FY':
                    if(records[I][field]!=''){
                        records[I].FY_Start='01/07/20'+(records[I].FY).substring(2,4);
                        records[I].FY_End='30/06/20'+(records[I].FY).substring(4,6);
                    }
                    _render();
                break;
            }
        }
        //-------------------------------------
        var title='';
        //-------------------------------------
        $('#D__ID').on('load',function(){
            title='Programme Code:'+_mobj.op.program_code+' | Project Code: '+_mobj.op.project_code+' | Actual Spending FY: '+_mobj.op.fy
            $('#parent__ID').text(title);
            $('#FY__ID').text(_mobj.op.fy);
			if(_mobj.op.amount_q1!=undefined) $('#Amount_Q1__ID').text(formatter.format(_mobj.op.amount_q1));
			if(_mobj.op.amount_q2!=undefined) $('#Amount_Q2__ID').text(formatter.format(_mobj.op.amount_q2));
			if(_mobj.op.amount_q3!=undefined) $('#Amount_Q3__ID').text(formatter.format(_mobj.op.amount_q3));
			if(_mobj.op.amount_q4!=undefined) $('#Amount_Q4__ID').text(formatter.format(_mobj.op.amount_q4));
            $('#Comments__ID').text(_mobj.op.comments);
            _set_req(); _request_data(); })
        //-------------------------------------
        _set_req=function(){
			var sql_where="";
			var parent_uid=_mobj.op.parent_uid;
			if(_mobj.op.parent_uid!=undefined){
				sql_where="where PUID="+parent_uid;
			}
		    var sql="with tb as (select Information,ID,UID,PUID,DateTime,Author,RowNum=row_number() over (order by ID DESC) from [TABLE-"+_db_pid+"-@S1] "+sql_where+")";
		    sql+="select Information,ID,UID,PUID,DateTime,Author,RowNum from tb where RowNum between @I6 and @I7";
		    var sql_n="select count(ID) from [TABLE-"+_db_pid+"-@S1] "+sql_where;
			_req={cmd:'query_records',db_pid:_db_pid,sql:sql,sql_n:sql_n,s1:'"'+$('#keyword__ID').val()+'"',I:$('#I__ID').text(),page_size:$('#page_size__ID').val()}
		}
        //-------------------------------------
        _before_submit=function(record,dbv){
            if(_mobj.op.parent_uid!=='') dbv.PUID=_mobj.op.parent_uid;
            dbv.PPID=_mobj.op.ppid;
            return true;
        };
        //-------------------------------------
    }
</script>
<style>
    VmInclude:/components/grid.v3.css
    #toolbar__ID{
		background-color:#ccc;
		padding:5px 0px;
		margin-bottom:0px;
		overflow:hidden
	}
	#toolbar__ID *{
		margin-right:3px;
	}
	#parent__ID{
		padding-top:5px
	}
	@media screen and (max-width:768px){
		#toolbar__ID{
			padding: 3px 0;
		}
		#toolbar__ID div{
			padding-left:3px;
		}
		#row_1__ID{
			padding-bottom: 3px;
		}
	}

</style>
