VmInclude:/modules/layout/top-right-corner.html
VmInclude:/modules/layout/header.html
VmInclude:/modules/layout/content-container.html
VmInclude:/modules/layout/footer.html
<script main-layout-js>
	function F__ID(){
		//------------------------------------
		setTimeout(function (){
			var header_height=$('#header__ID').outerHeight(); $vm.header_height=header_height;
			var footer_height=$('#footer__ID').outerHeight();
			$vm.min_height=($(window).height()-header_height-footer_height)+'px';
			$('#content_container__ID').css({'height':$vm.min_height});
			$('#content_container__ID').css({'top':header_height+'px'})
			console.log('window:'+$(window).height()+', header:'+header_height+', footer:'+footer_height);
		},1);
		//------------------------------------
		window.onmessage=function(e){
		    if(e.data.username!=undefined && e.data.user_id!=undefined){
		        $vm.user=e.data.username;
		        $vm.user_id=e.data.user_id;
		        $VmAPI.set_token(e.data.token,e.data.api_url,e.data.username,e.data.user_id,e.data.nickname);
		        location.reload(true);
		    }
		};
		//-----------------------------------------
		var show_top_right_corner=function(){
			if($vm.server=='development') $('#database_d__ID').show();
			else if($vm.server=='production') $('#database_p__ID').show();
		}
		show_top_right_corner();
		//========================================
		//load first module
		//$vm.load_config_and_init("/configurations/home-page.json");
		var url=$vm.hosting_path+"/configurations/index.json";
		var ver=localStorage.getItem(url+"_ver");
		var txt=localStorage.getItem(url+"_txt");
		//------------------------------------------
		if(ver!=$vm.version || txt===null || $vm.debug===true || $vm.reload!=''){
			console.log('loading '+url+'?_='+$vm.version+$vm.reload);
			$.get(url+'?_='+$vm.version+$vm.reload,function(data){
				localStorage.setItem(url+"_txt",data);
				localStorage.setItem(url+"_ver",$vm.version);
				$vm._panel_init(data);;
			},'text').fail(function() {
				alert( "The configuration file ("+url+") doesn't exist!" );
			});
		}
		else{ $vm._panel_init(txt); }
		//------------------------------------------
		//--------------------------------------------------------
		$vm._panel_init=function(txt){
		var text=$('<div/>').html(txt).text();
		//---------------------------
		var config;
		try{ config=JSON.parse(text);}
		catch (e){ alert("Error in app config file\n"+e); return; }
		//--------------------------------------------------------
		//group=config.group;
		var modules=config.modules;
			for (var property in modules) {
			   if($vm.module_list[property]==undefined) $vm.module_list[property]=modules[property];
			}
		}

		var name='home';
		var url=$vm.app_config.modules[name].url;
		url+='?_v='+$vm.version+$vm.reload;
		url=$vm.url(url);
		if(url[0]=='/') url=$vm.hosting_path+url;
		//---------------------------
		var module=name;
		$vm.module_list[module]={url:url,var:{},}
		//---------------------------
		$vm.load_module_by_name(module,$vm.root_layout_content_slot,{
			name:name,
			mobj:$vm.vm['__ID'],
			record:{UID:0},
			sys:{UID:0,}
		})
		//========================================
		/*
		var $image1 = $("<img>");
		$image1.on('load',(function(){ $('body').css("background", "url("+$(this).attr("src")+") no-repeat bottom center"); $('body').css("background-size", "cover");  }));
		$image1.attr("src", "__HOST__/images/background.jpg");
		*/
		//========================================
	}
</script>
<style main-layout-css>
	html,body{
		height:100%;
	}
</style>
